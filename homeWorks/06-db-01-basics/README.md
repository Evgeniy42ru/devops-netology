# Домашнее задание к занятию ["6.1. Типы и структура СУБД"](https://github.com/netology-code/virt-homeworks/blob/virt-11/06-db-01-basics/README.md)

## Введение

Перед выполнением задания вы можете ознакомиться с 
[дополнительными материалами](https://github.com/netology-code/virt-homeworks/tree/master/additional/README.md).

## Задача 1

Архитектор ПО решил проконсультироваться у вас, какой тип БД 
лучше выбрать для хранения определенных данных.

Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:

- Электронные чеки в json виде
- Склады и автомобильные дороги для логистической компании
- Генеалогические деревья
- Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации
- Отношения клиент-покупка для интернет-магазина

Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.

### Ответ
- Электронные чеки в json виде  
Документо-ориентированную, т.к. у нас документы в json формате.
- Склады и автомобильные дороги для логистической компании  
Графовую, если правильно понимаю для логистики нам нуже маршрут Из точки А в точку Б. Граф со связью логистических узлов, связи дорог и складов для построения маршрута.
- Генеалогические деревья  
Графовую, иерархическая тут не подходит т.к. может быть только один родитель.
- Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации  
Ключ-значение, для таких ситуаций идеально подходит.
- Отношения клиент-покупка для интернет-магазина  
Реляционная. Есть клиент, есть товар, связь клиент + товар = покупа, дополнительная ифорамация об оплате, времени, доставке.
При работе интернет магазина также часто потрбуется собирать статистику и агрегировать данные по клиентам, товарам, продажам.

## Задача 2

Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно 
CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если 
(каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):

- Данные записываются на все узлы с задержкой до часа (асинхронная запись)
- При сетевых сбоях, система может разделиться на 2 раздельных кластера
- Система может не прислать корректный ответ или сбросить соединение

### Ответ
- Данные записываются на все узлы с задержкой до часа (асинхронная запись)  
AP
- При сетевых сбоях, система может разделиться на 2 раздельных кластера  
AP
- Система может не прислать корректный ответ или сбросить соединение  
CP

### Дополнение:
Перед выполнением изучил статьи
- https://dev.to/mhihasan/cap-theorem-with-examples-hg4
- https://robertgreiner.com/cap-theorem-revisited/
- https://www.bigdataschool.ru/wiki/cap

>Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно  
CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если  
(каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):  

- Данные записываются на все узлы с задержкой до часа (асинхронная запись)
    Из данных условий я делаю вывод:
    Т. к. данные записываются в течении часа на все узлы, система в течении этого часа может выдать устаревшие данные. Значит мы жертвуем свойством Consistency. Так как узлов несколько у нас есть свойство Parition tolerance. Про ограничения в доступности ничего не сказано, значит у нас есть свойство Availability. Получаем AP класификацию.

    Возможно я неправильно интерпретировал условия, допустим в течении часа которого происходит запись, система недоступна, и будет отвечать только по окончанию записи(немного додумал условия). Получаем ограничения по доступности(-A), имеем несколько узлов(P), и т.к. ответ будет только после записи на все узлы имеем (С). Получаем классификацию PC.

- При сетевых сбоях, система может разделиться на 2 раздельных кластера
    Из данных условий я делаю вывод:
    При разделении система доступна, имеем (A). Система делится на кластеры, имеем (P). Кластеры раздельные, соответсвенно у нас не будет согласованности пока система не востановится, пользователи каждого кластера будут получать устаревшие данные (-С). Получаем классификацию AP.

- Система может не прислать корректный ответ или сбросить соединение
    Из данных условий я делаю вывод:
    Некорректный ответ - это не устаревшие данные, а именно некоректный ответ. Сброс соединения и некорректные ответы явно указывают на ограничения в доступности (-A). Про ограничения на разделения информации нет, предпололжим что система имеет это свойство (P), также нет информации про ошибки синхронизации и устаревшие данные, предположим что имеем свойство (С). Получаем классификацию CP.

После ознакомления с дополнительными материалами ответы не изменились, похоже я что-то не понял либо понял неверно.
Прошу разъяснить.
---

А согласно PACELC-теореме, как бы вы классифицировали данные реализации?

### Ответ
- Данные записываются на все узлы с задержкой до часа (асинхронная запись)  
PA
- При сетевых сбоях, система может разделиться на 2 раздельных кластера  
PA
- Система может не прислать корректный ответ или сбросить соединение  
EC

## Задача 3

Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?

Нет, т.к. они противоположны. Если мы следуем принципам BASE то пренебрегаем ACID и наоборот.

## Задача 4

Вам дали задачу написать системное решение, основой которого бы послужили:

- фиксация некоторых значений с временем жизни
- реакция на истечение таймаута

Вы слышали о key-value хранилище, которое имеет механизм [Pub/Sub](https://habr.com/ru/post/278237/). 
Что это за система? Какие минусы выбора данной системы?

### Ответ
Redis
> Redis довольно новая система и постоянно находятся в стадии усовершенствований. Это накладывает свою специфику именно в отношении надежности.

### Дополнение
Минусы redis которые я нашёл в данной статье.
- Redis медленне чем ZeroMQ
- `Redis довольно новые системы и постоянно находятся в стадии усовершенствований. Это накладывает свою специфику именно в отношении надежности.` Предполагаю что из-за постоянных обновлений системы можем поймать новую ошибку, т.к. система не находится долгое время в стабильной версии, постоянно обновляется.

Из лекции:
- “Из коробки” не имеет механизма консенсуса. При отказе ведущей реплики - необходимо вручную выбрать новую ведущую реплику.

Redis NoSql система, значит ей присущи общие минусы данных систем
- Данные не структурированы.
- Слабые ACID свойства, уклон в сторону BASE для производительности.

Возможно я неправильно понял условия задачи
>Вам дали задачу написать системное решение, основой которого бы послужили:
>- фиксация некоторых значений с временем жизни
>- реакция на истечение таймаута

Redis хорошо подходит для фиксации значений т.к. это key:value storage, также у него есть функционал присвоения значению timetolive. По достижению значения timetolive запись удаляется. Но такая ли нам реакция нужна? Если нет, то redis нам не подходит. Т. к. это не sql, вытащить все ключи по условиям их времени жизни будет весьма проблематично.

---
